package lan.wervel.jcs.ui.nb;

import java.awt.event.ActionEvent;
import javax.swing.ImageIcon;
import javax.swing.Timer;
import lan.wervel.jcs.common.TrackRepository;
import lan.wervel.jcs.repository.model.FeedbackModule;
import lan.wervel.jcs.ui.Refreshable;
import org.pmw.tinylog.Logger;

/**
 *
 * @author frans
 */
public class FeedbackPanel extends javax.swing.JPanel implements Refreshable {

  private static final long serialVersionUID = 8236086586653711732L;

  private static final String ICON_PATH_ON = "/media/Button-Purple-20px.png";
  private static final String ICON_PATH_OFF = "/media/Button-Grey-20px.png";

  private static final ImageIcon ICON_ON = new ImageIcon(FeedbackPanel.class.getResource(ICON_PATH_ON));
  private static final ImageIcon ICON_OFF = new ImageIcon(FeedbackPanel.class.getResource(ICON_PATH_OFF));

  private int number;
  private TrackRepository repository;
  private FeedbackModule feedbackModule;

  private Timer timer;

  public FeedbackPanel() {
    this(1, null);
  }

  /**
   * Creates new form FeedbackPanel
   *
   * @param number
   * @param repository
   */
  public FeedbackPanel(int number, TrackRepository repository) {
    this.number = number;
    this.repository = repository;
    initComponents();

    if (this.repository != null) {
      startRefreshCycle();
    }
  }

  /**
   * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The content of this
   * method is always regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    lbl1 = new javax.swing.JLabel();
    lbl2 = new javax.swing.JLabel();
    lbl3 = new javax.swing.JLabel();
    lbl4 = new javax.swing.JLabel();
    lbl5 = new javax.swing.JLabel();
    lbl6 = new javax.swing.JLabel();
    lbl7 = new javax.swing.JLabel();
    lbl8 = new javax.swing.JLabel();
    lbl9 = new javax.swing.JLabel();
    lbl10 = new javax.swing.JLabel();
    lbl11 = new javax.swing.JLabel();
    lbl12 = new javax.swing.JLabel();
    lbl13 = new javax.swing.JLabel();
    lbl14 = new javax.swing.JLabel();
    lbl15 = new javax.swing.JLabel();
    lbl16 = new javax.swing.JLabel();

    setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)), "S88 - 1"));
    setMinimumSize(new java.awt.Dimension(250, 95));
    setPreferredSize(new java.awt.Dimension(250, 95));
    setLayout(new java.awt.GridLayout(2, 8));

    lbl1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl1.setText("1");
    lbl1.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl1.setDoubleBuffered(true);
    lbl1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl1);

    lbl2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl2.setText("2");
    lbl2.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl2.setDoubleBuffered(true);
    lbl2.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl2);

    lbl3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl3.setText("3");
    lbl3.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl3.setDoubleBuffered(true);
    lbl3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl3);

    lbl4.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl4.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl4.setText("4");
    lbl4.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl4.setDoubleBuffered(true);
    lbl4.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl4);

    lbl5.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl5.setText("5");
    lbl5.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl5.setDoubleBuffered(true);
    lbl5.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl5);

    lbl6.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl6.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl6.setText("6");
    lbl6.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl6.setDoubleBuffered(true);
    lbl6.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl6);

    lbl7.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl7.setText("7");
    lbl7.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl7.setDoubleBuffered(true);
    lbl7.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl7);

    lbl8.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl8.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl8.setText("8");
    lbl8.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl8.setDoubleBuffered(true);
    lbl8.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl8);

    lbl9.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl9.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl9.setText("9");
    lbl9.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl9.setDoubleBuffered(true);
    lbl9.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    lbl9.setVerifyInputWhenFocusTarget(false);
    add(lbl9);

    lbl10.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl10.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl10.setText("10");
    lbl10.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl10.setDoubleBuffered(true);
    lbl10.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl10);

    lbl11.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl11.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl11.setText("11");
    lbl11.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl11.setDoubleBuffered(true);
    lbl11.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl11);

    lbl12.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl12.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl12.setText("12");
    lbl12.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl12.setDoubleBuffered(true);
    lbl12.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl12);

    lbl13.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl13.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl13.setText("13");
    lbl13.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl13.setDoubleBuffered(true);
    lbl13.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl13);

    lbl14.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl14.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl14.setText("14");
    lbl14.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl14.setDoubleBuffered(true);
    lbl14.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl14);

    lbl15.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl15.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl15.setText("15");
    lbl15.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl15.setDoubleBuffered(true);
    lbl15.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl15);

    lbl16.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lbl16.setIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl16.setText("16");
    lbl16.setDisabledIcon(new javax.swing.ImageIcon(getClass().getResource("/media/Button-Grey-20px.png"))); // NOI18N
    lbl16.setDoubleBuffered(true);
    lbl16.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
    add(lbl16);
  }// </editor-fold>//GEN-END:initComponents


  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JLabel lbl1;
  private javax.swing.JLabel lbl10;
  private javax.swing.JLabel lbl11;
  private javax.swing.JLabel lbl12;
  private javax.swing.JLabel lbl13;
  private javax.swing.JLabel lbl14;
  private javax.swing.JLabel lbl15;
  private javax.swing.JLabel lbl16;
  private javax.swing.JLabel lbl2;
  private javax.swing.JLabel lbl3;
  private javax.swing.JLabel lbl4;
  private javax.swing.JLabel lbl5;
  private javax.swing.JLabel lbl6;
  private javax.swing.JLabel lbl7;
  private javax.swing.JLabel lbl8;
  private javax.swing.JLabel lbl9;
  // End of variables declaration//GEN-END:variables

  @Override
  public void refresh() {
    if (this.repository == null || !this.repository.isFeedbackCycleRunning()) {
      return;
    }

    FeedbackModule fm = repository.getFeedbackModule(number);
    
    
    if (fm != null) {
      if (this.feedbackModule == null) {
        this.feedbackModule = fm;
      }

      this.lbl1.setIcon(fm.isPort1() ? ICON_ON : ICON_OFF);
      this.lbl2.setIcon(fm.isPort2() ? ICON_ON : ICON_OFF);
      this.lbl3.setIcon(fm.isPort3() ? ICON_ON : ICON_OFF);
      this.lbl4.setIcon(fm.isPort4() ? ICON_ON : ICON_OFF);
      this.lbl5.setIcon(fm.isPort5() ? ICON_ON : ICON_OFF);
      this.lbl6.setIcon(fm.isPort6() ? ICON_ON : ICON_OFF);
      this.lbl7.setIcon(fm.isPort7() ? ICON_ON : ICON_OFF);
      this.lbl8.setIcon(fm.isPort8() ? ICON_ON : ICON_OFF);
      this.lbl9.setIcon(fm.isPort9() ? ICON_ON : ICON_OFF);
      this.lbl10.setIcon(fm.isPort10() ? ICON_ON : ICON_OFF);
      this.lbl11.setIcon(fm.isPort11() ? ICON_ON : ICON_OFF);
      this.lbl12.setIcon(fm.isPort12() ? ICON_ON : ICON_OFF);
      this.lbl13.setIcon(fm.isPort13() ? ICON_ON : ICON_OFF);
      this.lbl14.setIcon(fm.isPort14() ? ICON_ON : ICON_OFF);
      this.lbl15.setIcon(fm.isPort15() ? ICON_ON : ICON_OFF);
      this.lbl16.setIcon(fm.isPort16() ? ICON_ON : ICON_OFF);

      this.feedbackModule.setResponse(fm.getResponse());
    }
  }

  public final void startRefreshCycle() {
    Logger.debug("Starting refresh cycle...");
    timer = new Timer(500, (ActionEvent e) -> {
      refresh();
    });

    timer.setRepeats(true);
    timer.start();
  }

}
